{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="main-content-container overflow-hidden">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4 mt-1">
        <h3 class="mb-0 text-dark">Task Management Dashboard</h3>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb align-items-center mb-0 lh-1">
                <li class="breadcrumb-item">
                    <a href="{% url 'dashboard' %}" class="d-flex align-items-center text-decoration-none">
                        <i class="ri-home-8-line fs-15 text-primary me-1"></i>
                        <span class="fs-14 text-dark hover">Dashboard</span>
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <span class="text-secondary">Task Dashboard</span>
                </li>
            </ol>
        </nav>
    </div>

    <!-- Filters -->
    <div class="card bg-white rounded-10 border border-white mb-4" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important; border-radius: 10px;">
        <div class="card-body">
            <form method="GET" action="" class="row g-3 align-items-end">
                <div class="col-xl-2 col-md-4">
                    <label class="form-label text-dark fw-medium">Date</label>
                    <input type="date" name="date" class="form-control bg-white" value="{{ current_date }}" style="border-radius: 6px; border: 1px solid #dee2e6; padding: 10px 12px; font-size: 14px; background-color: #ffffff !important;">
                </div>
                <div class="col-xl-2 col-md-4">
                    <label class="form-label text-dark fw-medium">Employee</label>
                    <select name="employee" class="form-select bg-white" style="border-radius: 6px; border: 1px solid #dee2e6; padding: 10px 12px; font-size: 14px; background-color: #ffffff !important;">
                        <option value="">All Employees</option>
                        {% for emp in employees %}
                        <option value="{{ emp.employeeId }}" {% if current_employee == emp.employeeId %}selected{% endif %}>
                            {{ emp.employeeId }} - {{ emp.employee_name|default:"N/A" }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-xl-2 col-md-4">
                    <label class="form-label text-dark fw-medium">Status</label>
                    <select name="status" class="form-select bg-white" style="border-radius: 6px; border: 1px solid #dee2e6; padding: 10px 12px; font-size: 14px; background-color: #ffffff !important;">
                        <option value="">All Status</option>
                        {% for status in status_choices %}
                        <option value="{{ status.0 }}" {% if current_status == status.0 %}selected{% endif %}>
                            {{ status.1 }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-xl-2 col-md-4">
                    <label class="form-label text-dark fw-medium">Task Type</label>
                    <select name="task_type" class="form-select bg-white" style="border-radius: 6px; border: 1px solid #dee2e6; padding: 10px 12px; font-size: 14px; background-color: #ffffff !important;">
                        <option value="">All Types</option>
                        {% for type in task_type_choices %}
                        <option value="{{ type.0 }}" {% if current_task_type == type.0 %}selected{% endif %}>
                            {{ type.1 }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-xl-2 col-md-4">
                    <label class="form-label text-dark fw-medium">Priority</label>
                    <select name="priority" class="form-select bg-white" style="border-radius: 6px; border: 1px solid #dee2e6; padding: 10px 12px; font-size: 14px; background-color: #ffffff !important;">
                        <option value="">All Priorities</option>
                        {% for priority in priority_choices %}
                        <option value="{{ priority.0 }}" {% if current_priority == priority.0 %}selected{% endif %}>
                            {{ priority.1 }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-xl-2 col-md-4">
                    <div class="d-flex gap-2 h-100">
                        <button type="submit" class="btn btn-primary text-white w-100 d-flex align-items-center justify-content-center gap-2 py-3" style="border-radius: 6px; font-weight: 500; border: 1px solid; transition: all 0.2s ease; padding: 12px 24px; font-size: 14px; min-height: 48px; display: flex; align-items: center; justify-content: center; background-color: #007bff; border-color: #007bff; color: white;">
                            <i class="material-symbols-outlined fs-16 text-white">filter_alt</i>
                            Apply
                        </button>
                        <a href="{% url 'task-dashboard' %}" class="btn btn-outline-secondary w-100 d-flex align-items-center justify-content-center gap-2 py-3" style="border-radius: 6px; font-weight: 500; border: 1px solid; transition: all 0.2s ease; padding: 12px 24px; font-size: 14px; min-height: 48px; display: flex; align-items: center; justify-content: center; background-color: white; border-color: #6c757d; color: #6c757d;">
                            <i class="material-symbols-outlined fs-16">refresh</i>
                            Reset
                        </a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card bg-primary bg-opacity-10 border border-primary border-opacity-25 rounded-10" style="border-radius: 10px;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="mb-0 text-dark">{{ total_tasks }}</h4>
                            <span class="text-dark">Total Tasks</span>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="material-symbols-outlined text-primary fs-32">task</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-success bg-opacity-10 border border-success border-opacity-25 rounded-10" style="border-radius: 10px;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="mb-0 text-dark">{{ completed_tasks }}</h4>
                            <span class="text-dark">Completed</span>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="material-symbols-outlined text-success fs-32">check_circle</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-warning bg-opacity-10 border border-warning border-opacity-25 rounded-10" style="border-radius: 10px;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="mb-0 text-dark">{{ in_progress_tasks }}</h4>
                            <span class="text-dark">In Progress</span>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="material-symbols-outlined text-warning fs-32">pending</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-danger bg-opacity-10 border border-danger border-opacity-25 rounded-10" style="border-radius: 10px;">
                <div class="card-body">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                            <h4 class="mb-0 text-dark">{{ not_started_tasks }}</h4>
                            <span class="text-dark">Not Started</span>
                        </div>
                        <div class="flex-shrink-0">
                            <i class="material-symbols-outlined text-danger fs-32">schedule</i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Today's Tasks & Urgent Tasks -->
    <div class="row">
        <!-- Today's Tasks -->
        <div class="col-lg-6">
            <div class="card bg-white rounded-10 border border-white mb-4" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important; border-radius: 10px;">
                <div class="card-header bg-white border-0" style="background-color: white !important; padding: 1.25rem 1.25rem 0.5rem;">
                    <h5 class="card-title mb-0 text-dark">
                        <i class="material-symbols-outlined me-2 fs-16 text-primary">today</i>
                        Today's Tasks
                    </h5>
                </div>
                <div class="card-body" style="background-color: white !important;">
                    {% if todays_tasks %}
                    <div class="table-responsive">
                        <table class="table align-middle w-100">
                            <thead>
                                <tr>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Task</th>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Employee</th>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Status</th>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Priority</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in todays_tasks %}
                                <tr>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">
                                        <a href="{% url 'task-detail' task.id %}" class="text-dark fw-medium text-decoration-none">
                                            {{ task.heading|truncatewords:5 }}
                                        </a>
                                    </td>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">{{ task.employee.employee_name|default:"N/A" }}</td>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">
                                        <span class="badge bg-{% if task.status == 'completed' %}success{% elif task.status == 'in_progress' %}warning{% else %}secondary{% endif %} bg-opacity-10 text-{% if task.status == 'completed' %}success{% elif task.status == 'in_progress' %}warning{% else %}secondary{% endif %} border border-{% if task.status == 'completed' %}success{% elif task.status == 'in_progress' %}warning{% else %}secondary{% endif %} border-opacity-25 rounded-pill px-3 py-1" style="font-size: 12px; font-weight: 500;">
                                            {{ task.get_status_display }}
                                        </span>
                                    </td>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">
                                        <span class="badge bg-{% if task.priority == 'urgent' %}danger{% elif task.priority == 'high' %}warning{% else %}info{% endif %} bg-opacity-10 text-{% if task.priority == 'urgent' %}danger{% elif task.priority == 'high' %}warning{% else %}info{% endif %} border border-{% if task.priority == 'urgent' %}danger{% elif task.priority == 'high' %}warning{% else %}info{% endif %} border-opacity-25 rounded-pill px-3 py-1" style="font-size: 12px; font-weight: 500;">
                                            {{ task.get_priority_display }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="material-symbols-outlined fs-48 text-muted">task</i>
                        <p class="mt-2 mb-0 text-muted">No tasks for today</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Urgent Tasks -->
        <div class="col-lg-6">
            <div class="card bg-white rounded-10 border border-white mb-4" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important; border-radius: 10px;">
                <div class="card-header bg-white border-0" style="background-color: white !important; padding: 1.25rem 1.25rem 0.5rem;">
                    <h5 class="card-title mb-0 text-dark">
                        <i class="material-symbols-outlined me-2 fs-16 text-danger">priority_high</i>
                        Urgent Tasks
                    </h5>
                </div>
                <div class="card-body" style="background-color: white !important;">
                    {% if urgent_tasks %}
                    <div class="table-responsive">
                        <table class="table align-middle w-100">
                            <thead>
                                <tr>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Task</th>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Due Date</th>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Employee</th>
                                    <th class="fw-medium text-dark" style="border-bottom: 2px solid #e9ecef; font-weight: 600; background: #f8f9fa; padding: 16px 12px;">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in urgent_tasks %}
                                <tr>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">
                                        <a href="{% url 'task-detail' task.id %}" class="text-dark fw-medium text-decoration-none">
                                            {{ task.heading|truncatewords:5 }}
                                        </a>
                                    </td>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">
                                        {% if task.due_date %}
                                        <span class="{% if task.due_date.date < today %}text-danger{% else %}text-dark{% endif %}">
                                            {{ task.due_date|date:"M d, Y" }}
                                        </span>
                                        {% else %}
                                        <span class="text-muted">Not set</span>
                                        {% endif %}
                                    </td>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">{{ task.employee.employee_name|default:"N/A" }}</td>
                                    <td style="border-bottom: 1px solid #f8f9fa; vertical-align: middle; padding: 16px 12px;">
                                        <span class="badge bg-{% if task.status == 'completed' %}success{% elif task.status == 'in_progress' %}warning{% else %}secondary{% endif %} bg-opacity-10 text-{% if task.status == 'completed' %}success{% elif task.status == 'in_progress' %}warning{% else %}secondary{% endif %} border border-{% if task.status == 'completed' %}success{% elif task.status == 'in_progress' %}warning{% else %}secondary{% endif %} border-opacity-25 rounded-pill px-3 py-1" style="font-size: 12px; font-weight: 500;">
                                            {{ task.get_status_display }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="material-symbols-outlined fs-48 text-muted">check_circle</i>
                        <p class="mt-2 mb-0 text-muted">No urgent tasks</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Only keeping what can't be inline - focus states and media queries */
.form-control:focus, .form-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.1);
    background-color: #ffffff;
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
    color: white;
    transform: translateY(-1px);
}

.btn-outline-secondary:hover {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
    transform: translateY(-1px);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .btn {
        padding: 10px 16px !important;
        font-size: 13px !important;
        min-height: 44px !important;
    }
    
    .table th, .table td {
        padding: 12px 8px !important;
    }
    
    .d-flex.gap-2 {
        gap: 8px !important;
    }
    
    .card-body {
        padding: 1rem !important;
    }
}
</style>
{% endblock %}