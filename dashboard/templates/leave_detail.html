{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="main-content-container overflow-hidden">
    <!-- Header with Back Button -->
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4 mt-1">
        <div class="d-flex align-items-center gap-3">
            <a href="{% url 'leave-list' %}" class="btn btn-outline-secondary d-flex align-items-center gap-2">
                <i class="material-symbols-outlined fs-16">arrow_back</i>
                Back to List
            </a>
            <h3 class="mb-0 text-dark">Leave Application Details</h3>
        </div>
        <div class="d-flex gap-2">
            {% if is_admin and leave.status == 'pending' %}
            <button type="button" 
                    class="btn btn-success d-flex align-items-center gap-2"
                    data-bs-toggle="modal" 
                    data-bs-target="#approveModal">
                <i class="material-symbols-outlined fs-16">check</i>
                Approve
            </button>
            <button type="button" 
                    class="btn btn-danger d-flex align-items-center gap-2"
                    data-bs-toggle="modal" 
                    data-bs-target="#rejectModal">
                <i class="material-symbols-outlined fs-16">close</i>
                Reject
            </button>
            {% endif %}
            {% if leave.employee == request.user and leave.status == 'pending' %}
            <button type="button" 
                    class="btn btn-outline-danger d-flex align-items-center gap-2"
                    data-bs-toggle="modal" 
                    data-bs-target="#cancelModal">
                <i class="material-symbols-outlined fs-16">delete</i>
                Cancel
            </button>
            {% endif %}
        </div>
    </div>

    <!-- Monthly Leave Alert -->
    {% if monthly_leave_count > 2 %}
    <div class="alert alert-warning alert-dismissible fade show mb-4" role="alert" style="background-color: #fff3cd; border-color: #ffecb5; color: #664d03;">
        <div class="d-flex align-items-center">
            <i class="material-symbols-outlined text-warning me-2 fs-20">warning</i>
            <div>
                <strong>High Monthly Leave Alert!</strong> 
                This employee has taken <span class="fw-bold">{{ monthly_leave_count }}</span> leaves in 
                {{ current_month|date:"F" }} {{ current_year }}. 
                This exceeds the standard 2 leaves per month.
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <!-- Leave Details Card -->
    <div class="row g-4">
        <!-- Left Column: Basic Information -->
        <div class="col-xl-8">
            <div class="card bg-white rounded-10 border border-white h-100" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important;">
                <div class="card-header bg-white border-0 pb-0" style="background-color: white !important; padding: 1.25rem 1.25rem 0.5rem;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 text-dark">Leave Information</h4>
                        <span class="badge bg-{% if leave.status == 'approved' %}success{% elif leave.status == 'rejected' %}danger{% elif leave.status == 'pending' %}warning{% elif leave.status == 'cancelled' %}secondary{% else %}info{% endif %} bg-opacity-10 text-{% if leave.status == 'approved' %}success{% elif leave.status == 'rejected' %}danger{% elif leave.status == 'pending' %}warning{% elif leave.status == 'cancelled' %}secondary{% else %}info{% endif %} border border-{% if leave.status == 'approved' %}success{% elif leave.status == 'rejected' %}danger{% elif leave.status == 'pending' %}warning{% elif leave.status == 'cancelled' %}secondary{% else %}info{% endif %} border-opacity-25 rounded-pill px-3 py-2" style="font-weight: 500; font-size: 13px;">
                            {{ leave.get_status_display }}
                        </span>
                    </div>
                </div>
                <div class="card-body bg-white" style="background-color: white !important;">
                    <div class="row g-3">
                        <!-- Leave Type -->
                        <div class="col-md-6">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Leave Type</span>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-info bg-opacity-10 d-flex align-items-center justify-content-center me-2" style="width: 36px; height: 36px;">
                                        <i class="material-symbols-outlined text-info fs-16">
                                            {% if leave.category == 'annual' %}calendar_today
                                            {% elif leave.category == 'sick' %}medical_services
                                            {% elif leave.category == 'casual' %}self_improvement
                                            {% elif leave.category == 'emergency' %}warning
                                            {% elif leave.category == 'maternity' %}pregnant_woman
                                            {% elif leave.category == 'paternity' %}family_restroom
                                            {% else %}event{% endif %}
                                        </i>
                                    </div>
                                    <span class="fw-medium text-dark fs-16">{{ leave.get_category_display }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Duration -->
                        <div class="col-md-6">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Duration</span>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center me-2" style="width: 36px; height: 36px;">
                                        <i class="material-symbols-outlined text-primary fs-16">calendar_today</i>
                                    </div>
                                    <div>
                                        <span class="fw-medium text-dark fs-16">{{ leave.total_days }} day{{ leave.total_days|pluralize }}</span>
                                        <small class="text-muted d-block">{{ leave.start_date|date:"M d, Y" }} to {{ leave.end_date|date:"M d, Y" }}</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Leave Count -->
                        <div class="col-12">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Monthly Leave Count</span>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle {% if monthly_leave_count > 2 %}bg-warning{% else %}bg-success{% endif %} bg-opacity-10 d-flex align-items-center justify-content-center me-2" style="width: 36px; height: 36px;">
                                        <i class="material-symbols-outlined {% if monthly_leave_count > 2 %}text-warning{% else %}text-success{% endif %} fs-16">counter_6</i>
                                    </div>
                                    <div>
                                        <span class="fw-medium text-dark fs-16">{{ monthly_leave_count }} leave{{ monthly_leave_count|pluralize }} in {{ current_month|date:"F" }}</span>
                                        {% if monthly_leave_count > 2 %}
                                        <small class="text-warning d-block fw-medium">
                                            <i class="material-symbols-outlined fs-14">warning</i>
                                            Exceeds standard monthly limit
                                        </small>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dates -->
                        <div class="col-md-6">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Start Date</span>
                                <div class="d-flex align-items-center">
                                    <i class="material-symbols-outlined text-primary me-2">calendar_month</i>
                                    <span class="fw-medium text-dark">{{ leave.start_date|date:"F d, Y" }}</span>
                                    {% if leave.is_past %}
                                    <span class="badge bg-secondary bg-opacity-10 text-secondary border border-secondary border-opacity-25 rounded-pill px-2 py-1 ms-2">
                                        Past
                                    </span>
                                    {% elif leave.is_active %}
                                    <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 rounded-pill px-2 py-1 ms-2">
                                        Active
                                    </span>
                                    {% elif leave.is_upcoming %}
                                    <span class="badge bg-info bg-opacity-10 text-info border border-info border-opacity-25 rounded-pill px-2 py-1 ms-2">
                                        Upcoming
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">End Date</span>
                                <div class="d-flex align-items-center">
                                    <i class="material-symbols-outlined text-primary me-2">calendar_month</i>
                                    <span class="fw-medium text-dark">{{ leave.end_date|date:"F d, Y" }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Ticket Eligibility -->
                        {% if leave.ticket_eligibility %}
                        <div class="col-md-6">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Ticket Eligibility</span>
                                <div class="d-flex align-items-center">
                                    <i class="material-symbols-outlined text-info me-2">confirmation_number</i>
                                    <span class="fw-medium text-dark">{{ leave.get_ticket_eligibility_display }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Passport Required -->
                        {% if leave.passport_required_from %}
                        <div class="col-md-6">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Passport Required From</span>
                                <div class="d-flex align-items-center">
                                    <i class="material-symbols-outlined text-warning me-2">passkey</i>
                                    <span class="fw-medium text-dark">{{ leave.passport_required_from|date:"F d, Y" }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Reason for Leave -->
                        <div class="col-12">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Reason for Leave</span>
                                <div class="card bg-white border border-light rounded-10 p-3" style="background-color: white !important;">
                                    <p class="mb-0 text-dark">{{ leave.reason|default:"No reason provided"|linebreaks }}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Address During Leave -->
                        {% if leave.address_during_leave %}
                        <div class="col-12">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Address During Leave</span>
                                <div class="card bg-white border border-light rounded-10 p-3" style="background-color: white !important;">
                                    <p class="mb-0 text-dark">{{ leave.address_during_leave|linebreaks }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Rejection Reason -->
                        {% if leave.status == 'rejected' and leave.rejection_reason %}
                        <div class="col-12">
                            <div class="info-item" style="margin-bottom: 1.5rem;">
                                <span class="text-muted d-block mb-1">Rejection Reason</span>
                                <div class="card bg-danger bg-opacity-10 border border-danger border-opacity-25 rounded-10 p-3" style="background-color: white !important;">
                                    <p class="mb-0 text-danger">{{ leave.rejection_reason|linebreaks }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Employee & Approval Info -->
        <div class="col-xl-4">
            <!-- Employee Information Card -->
            <div class="card bg-white rounded-10 border border-white mb-4" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important;">
                <div class="card-header bg-white border-0 pb-0" style="background-color: white !important; padding: 1.25rem 1.25rem 0.5rem;">
                    <h5 class="mb-0 text-dark">Employee Information</h5>
                </div>
                <div class="card-body bg-white" style="background-color: white !important;">
                    <div class="text-center mb-4">
                        {% if leave.employee.profile_pic %}
                            <img src="{{ leave.employee.profile_pic.url }}" 
                                 class="rounded-circle mb-3" 
                                 style="width: 100px; height: 100px; object-fit: cover;" 
                                 alt="{{ leave.employee.employee_name }}">
                        {% else %}
                            <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 100px; height: 100px;">
                                <span class="text-white fw-bold fs-24">{{ leave.employee.employee_name|default:leave.employee.employeeId|first|upper }}</span>
                            </div>
                        {% endif %}
                        <h5 class="mb-1 text-dark">{{ leave.employee.employee_name|default:"Not Set" }}</h5>
                        <p class="text-muted mb-2">{{ leave.employee.employeeId }}</p>
                        <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25 rounded-pill px-3 py-1" style="font-weight: 500; font-size: 13px;">
                            {{ leave.employee.get_designation_display|default:"Not Set" }}
                        </span>
                    </div>
                    
                    <div class="row g-2">
                        <div class="col-12">
                            <div class="d-flex align-items-center mb-2">
                                <i class="material-symbols-outlined text-primary me-2">work</i>
                                <span class="text-muted">Department:</span>
                                <span class="fw-medium text-dark ms-2">{{ leave.employee.get_department_display|default:"Not Set" }}</span>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="d-flex align-items-center mb-2">
                                <i class="material-symbols-outlined text-primary me-2">business</i>
                                <span class="text-muted">Profession:</span>
                                <span class="fw-medium text-dark ms-2">{{ leave.employee.get_profession_display|default:"Not Set" }}</span>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="d-flex align-items-center mb-2">
                                <i class="material-symbols-outlined text-primary me-2">location_on</i>
                                <span class="text-muted">Branch:</span>
                                <span class="fw-medium text-dark ms-2">{{ leave.employee.branch_location|default:"Not Set" }}</span>
                            </div>
                        </div>
                        {% if leave.employee.mobile_number %}
                        <div class="col-12">
                            <div class="d-flex align-items-center mb-2">
                                <i class="material-symbols-outlined text-primary me-2">phone</i>
                                <span class="text-muted">Mobile:</span>
                                <span class="fw-medium text-dark ms-2">{{ leave.employee.mobile_number }}</span>
                            </div>
                        </div>
                        {% endif %}
                        {% if leave.employee.email %}
                        <div class="col-12">
                            <div class="d-flex align-items-center mb-2">
                                <i class="material-symbols-outlined text-primary me-2">mail</i>
                                <span class="text-muted">Email:</span>
                                <span class="fw-medium text-dark ms-2">{{ leave.employee.email }}</span>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Modern Timeline Card -->
            <div class="card bg-white rounded-10 border border-white" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important;">
                <div class="card-header bg-white border-0 pb-0" style="background-color: white !important; padding: 1.25rem 1.25rem 0.5rem;">
                    <h5 class="mb-0 text-dark">Application Timeline</h5>
                </div>
                <div class="card-body bg-white" style="background-color: white !important;">
                    <div style="position: relative; padding-left: 30px;">
                        <!-- Applied -->
                        <div style="position: relative; margin-bottom: 2rem; display: flex; align-items: flex-start;">
                            <div style="position: absolute; left: -50px; top: 0; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: #198754; color: white; z-index: 2; border: 3px solid white; transition: all 0.3s ease;">
                                <i class="material-symbols-outlined">edit_calendar</i>
                            </div>
                            <div style="flex: 1; padding-top: 5px;">
                                <h6 class="mb-1 text-dark fw-semibold">Application Submitted</h6>
                                <p class="text-muted mb-0">{{ leave.created_at|date:"M d, Y" }}</p>
                                <p class="text-muted mb-0 small">{{ leave.created_at|date:"h:i A" }}</p>
                            </div>
                        </div>
                        
                        {% if leave.status == 'approved' or leave.status == 'rejected' or leave.status == 'cancelled' %}
                        <!-- Review -->
                        <div style="position: relative; margin-bottom: 2rem; display: flex; align-items: flex-start;">
                            <div style="position: absolute; left: -50px; top: 0; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: #198754; color: white; z-index: 2; border: 3px solid white; transition: all 0.3s ease;">
                                <i class="material-symbols-outlined">rate_review</i>
                            </div>
                            <div style="flex: 1; padding-top: 5px;">
                                <h6 class="mb-1 text-dark fw-semibold">Under Review</h6>
                                <p class="text-muted mb-0">
                                    {% if leave.status == 'approved' %}
                                    <span class="badge bg-success bg-opacity-10 text-success">Approved</span>
                                    {% elif leave.status == 'rejected' %}
                                    <span class="badge bg-danger bg-opacity-10 text-danger">Rejected</span>
                                    {% elif leave.status == 'cancelled' %}
                                    <span class="badge bg-secondary bg-opacity-10 text-secondary">Cancelled</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        
                        <!-- Final Status -->
                        <div style="position: relative; margin-bottom: 0; display: flex; align-items: flex-start;">
                            <div style="position: absolute; left: -50px; top: 0; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: {% if leave.status == 'approved' %}#198754{% elif leave.status == 'rejected' %}#dc3545{% elif leave.status == 'cancelled' %}#6c757d{% endif %}; color: white; z-index: 2; border: 3px solid white; transition: all 0.3s ease;">
                                <i class="material-symbols-outlined">
                                    {% if leave.status == 'approved' %}check_circle
                                    {% elif leave.status == 'rejected' %}cancel
                                    {% elif leave.status == 'cancelled' %}block{% endif %}
                                </i>
                            </div>
                            <div style="flex: 1; padding-top: 5px;">
                                <h6 class="mb-1 text-dark fw-semibold">
                                    {% if leave.status == 'approved' %}Approved
                                    {% elif leave.status == 'rejected' %}Rejected
                                    {% elif leave.status == 'cancelled' %}Cancelled{% endif %}
                                </h6>
                                {% if leave.approved_at %}
                                <p class="text-muted mb-0">{{ leave.approved_at|date:"M d, Y" }}</p>
                                <p class="text-muted mb-0 small">{{ leave.approved_at|date:"h:i A" }}</p>
                                {% endif %}
                                {% if leave.approved_by %}
                                <p class="text-muted mb-0 small">By: {{ leave.approved_by.employee_name|default:leave.approved_by.employeeId }}</p>
                                {% endif %}
                            </div>
                        </div>
                        {% elif leave.status == 'pending' %}
                        <!-- Pending Status -->
                        <div style="position: relative; margin-bottom: 0; display: flex; align-items: flex-start;">
                            <div style="position: absolute; left: -50px; top: 0; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background-color: #ffc107; color: white; z-index: 2; border: 3px solid white; transition: all 0.3s ease; animation: pulse 2s infinite;">
                                <i class="material-symbols-outlined">pending</i>
                            </div>
                            <div style="flex: 1; padding-top: 5px;">
                                <h6 class="mb-1 text-dark fw-semibold">Pending Approval</h6>
                                <p class="text-muted mb-0">Awaiting admin review</p>
                                <div class="progress mt-2" style="height: 6px; background-color: #e9ecef; border-radius: 3px;">
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 50%; border-radius: 3px;" 
                                         aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attachment Section -->
    {% if leave.attachment %}
    <div class="card bg-white rounded-10 border border-white mt-4" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important;">
        <div class="card-header bg-white border-0" style="background-color: white !important; padding: 1.25rem 1.25rem 0.5rem;">
            <h5 class="mb-0 text-dark">Attachment</h5>
        </div>
        <div class="card-body bg-white" style="background-color: white !important;">
            <div class="d-flex align-items-center">
                <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                    <i class="material-symbols-outlined text-primary fs-24">attach_file</i>
                </div>
                <div class="flex-grow-1">
                    <h6 class="mb-1 text-dark">{{ leave.attachment.name|cut:"leave_attachments/" }}</h6>
                    <small class="text-muted">Attachment file</small>
                </div>
                <div>
                    <a href="{{ leave.attachment.url }}" 
                       class="btn btn-primary d-flex align-items-center gap-2" 
                       target="_blank" style="border-radius: 6px; font-weight: 500; transition: all 0.2s ease; padding: 10px 20px; font-size: 14px; min-height: 44px; display: flex; align-items: center; justify-content: center; background-color: #198754; border-color: #198754; color: white !important;">
                        <i class="material-symbols-outlined fs-16 text-white">download</i>
                        <span class="text-white">Download</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Signature Section (Text field display) -->
    {% if leave.signature %}
    <div class="card bg-white rounded-10 border border-white mt-4" style="box-shadow: 0 2px 4px rgba(0,0,0,0.05); background-color: white !important;">
        <div class="card-header bg-white border-0" style="background-color: white !important; padding: 1.25rem 1.25rem 0.5rem;">
            <h5 class="mb-0 text-dark">Signature</h5>
        </div>
        <div class="card-body bg-white" style="background-color: white !important;">
            <div style="background-color: white;">
                <div class="signature-header mb-3" style="display: flex; align-items: center; color: #6c757d;">
                    <i class="material-symbols-outlined text-primary me-2">draw</i>
                    <span class="text-muted">Employee Digital Signature</span>
                </div>
                <div class="signature-content p-4 border rounded-10" style="background-color: #f8f9fa; border: 1px solid #e9ecef;">
                    <div class="signature-text mb-3" style="font-family: 'Brush Script MT', cursive; font-size: 1.5rem; min-height: 60px; display: flex; align-items: center;">
                        <span class="text-muted d-block mb-1">Signature Text:</span>
                        <p class="mb-0 text-dark fst-italic">{{ leave.signature }}</p>
                    </div>
                    <div class="signature-verification" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px dashed #dee2e6;">
                        <small class="text-muted">
                            <i class="material-symbols-outlined text-success fs-14">verified</i>
                            This signature was submitted with the leave application on {{ leave.created_at|date:"F d, Y" }}
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Approve Confirmation Modal -->
<div class="modal fade" id="approveModal" tabindex="-1" aria-labelledby="approveModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border: none; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <div class="modal-header bg-white" style="background-color: white !important; border-bottom: 1px solid #e9ecef; border-radius: 10px 10px 0 0;">
                <h5 class="modal-title text-dark" id="approveModalLabel">Approve Leave Application</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body bg-white" style="background-color: white !important;">
                <p class="mb-3 text-dark">Are you sure you want to approve this leave application?</p>
                <div class="alert alert-info bg-info bg-opacity-10 border border-info border-opacity-25">
                    <div class="d-flex">
                        <i class="material-symbols-outlined text-info me-2">info</i>
                        <div>
                            <small class="text-dark">
                                <strong>Leave Details:</strong><br>
                                Employee: {{ leave.employee.employee_name }}<br>
                                Period: {{ leave.start_date|date:"M d, Y" }} to {{ leave.end_date|date:"M d, Y" }}<br>
                                Duration: {{ leave.total_days }} day{{ leave.total_days|pluralize }}<br>
                                {% if monthly_leave_count > 2 %}
                                <span class="text-warning fw-bold">
                                    <i class="material-symbols-outlined fs-14">warning</i>
                                    Note: This employee has {{ monthly_leave_count }} leaves this month
                                </span>
                                {% endif %}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-white" style="background-color: white !important; border-top: 1px solid #e9ecef; border-radius: 0 0 10px 10px;">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="border-radius: 6px; font-weight: 500; transition: all 0.2s ease; padding: 10px 20px; font-size: 14px; min-height: 44px; display: flex; align-items: center; justify-content: center; background-color: white; border-color: #6c757d; color: #6c757d;">Cancel</button>
                <form method="POST" action="{% url 'approve-leave' leave.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success" style="border-radius: 6px; font-weight: 500; transition: all 0.2s ease; padding: 10px 20px; font-size: 14px; min-height: 44px; display: flex; align-items: center; justify-content: center; background-color: #198754; border-color: #198754; color: white !important;">
                        <i class="material-symbols-outlined fs-16 me-1">check</i>
                        <span class="text-white">Approve Leave</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Reject Confirmation Modal -->
<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border: none; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <div class="modal-header bg-white" style="background-color: white !important; border-bottom: 1px solid #e9ecef; border-radius: 10px 10px 0 0;">
                <h5 class="modal-title text-dark" id="rejectModalLabel">Reject Leave Application</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'reject-leave' leave.id %}">
                {% csrf_token %}
                <div class="modal-body bg-white" style="background-color: white !important;">
                    <p class="mb-3 text-dark">Please provide a reason for rejecting this leave application.</p>
                    <div class="mb-3">
                        <label for="rejectionReason" class="form-label text-dark">Reason for Rejection <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="rejectionReason" name="rejection_reason" rows="4" placeholder="Enter the reason for rejection..." required></textarea>
                    </div>
                    <div class="alert alert-warning bg-warning bg-opacity-10 border border-warning border-opacity-25" style="background-color: #fff3cd; border-color: #ffecb5; color: #664d03;">
                        <div class="d-flex">
                            <i class="material-symbols-outlined text-warning me-2">warning</i>
                            <div>
                                <small class="text-dark">
                                    <strong>Note:</strong> This action cannot be undone. The employee will be notified of the rejection.
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-white" style="background-color: white !important; border-top: 1px solid #e9ecef; border-radius: 0 0 10px 10px;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="border-radius: 6px; font-weight: 500; transition: all 0.2s ease; padding: 10px 20px; font-size: 14px; min-height: 44px; display: flex; align-items: center; justify-content: center; background-color: white; border-color: #6c757d; color: #6c757d;">Cancel</button>
                    <button type="submit" class="btn btn-danger" style="border-radius: 6px; font-weight: 500; transition: all 0.2s ease; padding: 10px 20px; font-size: 14px; min-height: 44px; display: flex; align-items: center; justify-content: center; background-color: #dc3545; border-color: #dc3545; color: white !important;">
                        <i class="material-symbols-outlined fs-16 me-1">close</i>
                        <span class="text-white">Reject Leave</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Cancel Confirmation Modal -->
{% if leave.employee == request.user and leave.status == 'pending' %}
<div class="modal fade" id="cancelModal" tabindex="-1" aria-labelledby="cancelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="border: none; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <div class="modal-header bg-white" style="background-color: white !important; border-bottom: 1px solid #e9ecef; border-radius: 10px 10px 0 0;">
                <h5 class="modal-title text-dark" id="cancelModalLabel">Cancel Leave Application</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body bg-white" style="background-color: white !important;">
                <p class="mb-3 text-dark">Are you sure you want to cancel this leave application?</p>
                <div class="alert alert-warning bg-warning bg-opacity-10 border border-warning border-opacity-25" style="background-color: #fff3cd; border-color: #ffecb5; color: #664d03;">
                    <div class="d-flex">
                        <i class="material-symbols-outlined text-warning me-2">warning</i>
                        <div>
                            <small class="text-dark">
                                <strong>Important:</strong> This action cannot be undone. Once cancelled, this leave application will be removed from pending requests.
                            </small>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="material-symbols-outlined text-info fs-14">info</i>
                        Leave Details: {{ leave.start_date|date:"M d, Y" }} to {{ leave.end_date|date:"M d, Y" }} ({{ leave.total_days }} days)
                    </small>
                </div>
            </div>
            <div class="modal-footer bg-white" style="background-color: white !important; border-top: 1px solid #e9ecef; border-radius: 0 0 10px 10px;">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="border-radius: 6px; font-weight: 500; transition: all 0.2s ease; padding: 10px 20px; font-size: 14px; min-height: 44px; display: flex; align-items: center; justify-content: center; background-color: white; border-color: #6c757d; color: #6c757d;">No, Keep It</button>
                <form method="POST" action="{% url 'cancel-leave' leave.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger" style="border-radius: 6px; font-weight: 500; transition: all 0.2s ease; padding: 10px 20px; font-size: 14px; min-height: 44px; display: flex; align-items: center; justify-content: center; background-color: #dc3545; border-color: #dc3545; color: white !important;">
                        <i class="material-symbols-outlined fs-16 me-1">delete</i>
                        <span>Yes, Cancel Leave</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
/* This style tag only contains what can't be inline - animations and media queries */
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(255, 193, 7, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
}

/* Responsive Design - can't be inline */
@media (max-width: 768px) {
    .btn {
        padding: 8px 16px !important;
        font-size: 13px !important;
        min-height: 40px !important;
    }
    
    .signature-text {
        font-size: 1.2rem !important;
    }
    
    h3 {
        font-size: 1.5rem;
    }
    
    h5 {
        font-size: 1.1rem;
    }
    
    .card-body {
        padding: 1rem !important;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    });

    // Form validation for rejection modal
    const rejectForm = document.querySelector('#rejectModal form');
    if (rejectForm) {
        rejectForm.addEventListener('submit', function(e) {
            const reasonField = document.getElementById('rejectionReason');
            if (!reasonField.value.trim()) {
                e.preventDefault();
                alert('Please provide a reason for rejection.');
                reasonField.focus();
            }
        });
    }
});
</script>
{% endblock %}